Turbo Assembler	 Version 2.0	    04/27/18 17:27:45	    Page 1
p4a.asm



      1				     ;**************************************************************************
      2				     ; MICROPROCESSOR-BASED SYSTEMS
      3				     ; LAB SESSION 4
      4				     ; FILE: p4a.asm
      5				     ; AUTHORS:	Emilio Cuesta Fernandez	- Alejandro Sanchez Sanz
      6				     ; COUPLE NUMBER: 8
      7				     ; GROUP: 2351
      8				     ;**************************************************************************
      9
     10
     11
     12				     ;**************************************************************************
     13				     ; CODE SEGMENT DEFINITION
     14	0000			     CODE SEGMENT
     15					     ASSUME CS:	CODE
     16					     ; First assembly instruction must be after	the 256	bytes of PSP, so this is
     17					     ; necessary to generate a .COM file
     18					     ORG 256
     19
     20				     ; BEGINNING OF THE	MAIN PROCEDURE
     21	0100			     INICIO:
     22					     ; Check input parameters
     23	0100  8A 0E 0080		     MOV CL, DS:[80h]	     ; Load the	size of	the parameters in the command line
     24					     ; No parameters
     25
     26	0104  E9 008B			     JMP STATUS
     27					     ; /I as parameter
     28
     29	0107  EB 44 90			     JMP INSTALLER
     30					     ; /U as parameter
     31
     32	010A  EB 5B 90			     JMP UNINSTALLER
     33
     34					     ; GLOBAL VARIABLES
     35	010D  0B			     CODE_NUMBER DB 11	; Codification number. We are team 8, so it is 8+3=11
     36	010E  0000			     FLAG DW 0
     37
     38	0110				     CAESAR PROC FAR ; INTERRUPT SERVICE ROUTINE
     39						     ; SAVE MODIFIED REGISTERS
     40	0110  56 53 50				     PUSH SI BX	AX
     41						     ; ROUTINE INSTRUCTIONS
     42						     ; We know the string is pointed by	DS:DX
     43	0113  BE 0000				     MOV SI, 0		     ; Initialize the index
     44	0116  8B DA				     MOV BX, DX
     45										     ; We have to check	AH
     46	0118  80 FC 12				     CMP AH, 12h     ; Encrypt and print
     47	011B  74 08				     JE	ENCRYPT
     48	011D  80 FC 13				     CMP AH, 13h     ; Decrypt and print
     49	0120  74 13				     JE	DECRYPT
     50	0122  EB 25 90				     JMP FIN
     51
     52
     53	0125				     ENCRYPT:
     54	0125  8A 00				     MOV AL, DS:[BX][SI]
     55	0127  3C 24				     CMP AL, '$'
     56	0129  74 1A				     JE	PRINT
     57	012B  2E: 02 06	010Dr			     ADD AL, CODE_NUMBER
Turbo Assembler	 Version 2.0	    04/27/18 17:27:45	    Page 2
p4a.asm



     58	0130  88 00				     MOV DS:[BX][SI], AL
     59	0132  46				     INC SI
     60	0133  EB F0				     JMP ENCRYPT
     61
     62	0135				     DECRYPT:
     63	0135  8A 00				     MOV AL, DS:[BX][SI]
     64	0137  3C 24				     CMP AL, '$'
     65	0139  74 0A				     JE	PRINT
     66	013B  2E: 2A 06	010Dr			     SUB AL, CODE_NUMBER
     67	0140  88 00				     MOV DS:[BX][SI], AL
     68	0142  46				     INC SI
     69	0143  EB F0				     JMP DECRYPT
     70
     71	0145				     PRINT:
     72	0145  B4 09				     MOV AH, 09h
     73	0147  CD 21				     INT 21h		     ; Print the string	after processing it. Offset is	    +
     74				     already in	DX
     75						     ; RESTORE MODIFIED	REGISTERS
     76	0149				     FIN:
     77	0149  58 5B 5E				     POP AX BX SI
     78	014C  CF				     IRET
     79
     80	014D				     CAESAR ENDP
     81
     82
     83	014D				     INSTALLER PROC
     84	014D  B8 0000				     MOV AX, 0
     85	0150  8E C0				     MOV ES, AX
     86	0152  B8 0110r				     MOV AX, OFFSET CAESAR
     87	0155  8C CB				     MOV BX, CS
     88	0157  FA				     CLI
     89	0158  26: A3 0154			     MOV ES:[ 55H*4 ], AX
     90	015C  26: 89 1E	0156			     MOV ES:[ 55H*4+2 ], BX
     91	0161  FB				     STI
     92	0162  BA 014Dr				     MOV DX, OFFSET INSTALLER
     93	0165  CD 27				     INT 27H ; TERMINATE AND STAY RESIDENT
     94						     ; PSP, VARIABLES, CAESAR ROUTINE.
     95	0167				     INSTALLER ENDP
     96
     97	0167				     UNINSTALLER PROC ;	UNINSTALL CAESAR OF INT	55H
     98	0167  50 53 51 1E 06			     PUSH AX BX	CX DS ES
     99	016C  B9 0000				     MOV CX, 0
    100	016F  8E D9				     MOV DS, CX						     ; SEGMENT OF INTERRUPT +
    101				     VECTORS
    102	0171  8E 06 0156			     MOV ES, DS:[ 55H*4+2 ]		     ; READ CAESAR SEGMENT
    103	0175  26: 8B 1E	002C			     MOV BX, ES:[ 2CH ]				     ; READ SEGMENT OF ENVIRONMENT  +
    104				     FROM CAESAR’S PSP.
    105	017A  B4 49				     MOV AH, 49H
    106	017C  CD 21				     INT 21H						     ; RELEASE CAESAR	    +
    107				     SEGMENT (ES)
    108	017E  8E C3				     MOV ES, BX
    109	0180  CD 21				     INT 21H						     ; RELEASE SEGMENT OF   +
    110				     ENVIRONMENT VARIABLES OF CAESAR
    111						     ; SET VECTOR OF INTERRUPT 55H TO ZERO
    112	0182  FA				     CLI
    113	0183  89 0E 0154			     MOV DS:[ 55H*4 ], CX		     ; CX = 0
    114	0187  89 0E 0156			     MOV DS:[ 55H*4+2 ], CX
Turbo Assembler	 Version 2.0	    04/27/18 17:27:45	    Page 3
p4a.asm



    115	018B  FB				     STI
    116	018C  07 1F 59 5B 58			     POP ES DS CX BX AX
    117	0191  C3				     RET
    118	0192				     UNINSTALLER ENDP
    119
    120
    121	0192				     STATUS:
    122						     ; it shall	show the installation status of	the driver (installed/uninstalled), +
    123				     the team number and the names of the programmers
    124
    125
    126					     ; NOT SURE	IF IT IS NECESSARY
    127	0192  B8 4C00			     MOV AX, 4C00h
    128	0195  CD 21			     INT 21h
    129
    130				     ; END OF CODE SEGMENT
    131	0197			     CODE ENDS
    132				     ; END OF PROGRAM. OBS: INCLUDES THE ENTRY OR THE FIRST PROCEDURE (i.e. “INICIO”)
    133				     END INICIO
Turbo Assembler	 Version 2.0	    04/27/18 17:27:45	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "04/27/18"
??FILENAME			  Text	 "p4a	  "
??TIME				  Text	 "17:27:45"
??VERSION			  Number 0200
@CPU				  Text	 0101H
@CURSEG				  Text	 CODE
@FILENAME			  Text	 P4A
@WORDSIZE			  Text	 2
CAESAR				  Far	 CODE:0110
CODE_NUMBER			  Byte	 CODE:010D
DECRYPT				  Near	 CODE:0135
ENCRYPT				  Near	 CODE:0125
FIN				  Near	 CODE:0149
FLAG				  Word	 CODE:010E
INICIO				  Near	 CODE:0100
INSTALLER			  Near	 CODE:014D
PRINT				  Near	 CODE:0145
STATUS				  Near	 CODE:0192
UNINSTALLER			  Near	 CODE:0167

Groups & Segments		  Bit Size Align  Combine Class

CODE				  16  0197 Para	  none
